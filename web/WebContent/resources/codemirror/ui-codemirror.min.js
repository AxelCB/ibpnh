"use strict";angular.module("ui.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["uiCodemirrorConfig",function(a){return{restrict:"EA",require:"?ngModel",priority:1,compile:function b(d){if(angular.isUndefined(window.CodeMirror)){throw new Error("ui-codemirror need CodeMirror to work... (o rly?)")}var f=d.text();var e=new window.CodeMirror(function(g){angular.forEach(d.prop("attributes"),function(h){if(h.name==="ui-codemirror"){g.setAttribute("ui-codemirror-opts",h.textContent)}else{g.setAttribute(h.name,h.textContent)}});if(d.parent().length<=0){d.wrap("<div>")}d.replaceWith(g)},{value:f});$(e.display.input).data("CodeMirrorInstance",e);return function c(j,l,i,m){var h,k;h=a.codemirror||{};k=angular.extend({},h,j.$eval(i.uiCodemirror),j.$eval(i.uiCodemirrorOpts));function g(n){for(var o in n){if(n.hasOwnProperty(o)){e.setOption(o,n[o])}}}g(k);if(angular.isDefined(j.$eval(i.uiCodemirror))){j.$watch(i.uiCodemirror,g,true)}if(m){m.$formatters.push(function(n){if(angular.isUndefined(n)||n===null){return""}else{if(angular.isObject(n)||angular.isArray(n)){throw new Error("ui-codemirror cannot use an object or an array as a model")}}return n});m.$render=function(){var n=m.$viewValue||"";e.setValue(n)};e.on("change",function(n){var o=n.getValue();if(o!==m.$viewValue){j.$apply(function(){m.$setViewValue(o)})}})}if(i.uiRefresh){j.$watch(i.uiRefresh,function(o,n){if(o!==n){e.refresh()}})}j.$on("CodeMirror",function(n,o){if(angular.isFunction(o)){o(e)}else{throw new Error("the CodeMirror event requires a callback function")}});if(angular.isFunction(k.onLoad)){k.onLoad(e)}}}}}]);